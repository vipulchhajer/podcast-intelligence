# Cursor AI Rules for Podcast Intelligence App

## Project Context
This is an AI-powered podcast transcription and summarization web app built with:
- **Backend:** FastAPI (Python), SQLAlchemy, SQLite
- **Frontend:** React + Vite + Tailwind CSS
- **AI Services:** Groq API (Whisper for transcription, Llama 3.3 for summarization)

## Critical Files to Reference

### ALWAYS read these files before suggesting code changes:
1. **DEVELOPMENT.md** - Development guidelines, checklists, and patterns
2. **frontend/src/hooks/usePolling.js** - Reusable polling hook for status updates
3. **WEB_APP_README.md** - Architecture and setup documentation

## Mandatory Patterns

### 1. Real-Time Status Updates
When creating pages that display episode statuses:
- ‚úÖ MUST use `usePolling` hook from `frontend/src/hooks/usePolling.js`
- ‚úÖ MUST follow the checklist in DEVELOPMENT.md section "Real-Time Status Updates"
- ‚úÖ MUST poll every 3 seconds for status changes
- ‚úÖ MUST support "silent" mode to avoid showing loading spinners during polling

Example:
```javascript
import { usePolling } from '../hooks/usePolling'
usePolling(() => fetchData(true), 3000, [dependencies])
```

### 2. Status Badges
ALWAYS use consistent status badge colors:
- `pending` ‚Üí yellow
- `downloading` ‚Üí blue
- `transcribing` ‚Üí indigo
- `summarizing` ‚Üí purple
- `completed` ‚Üí green
- `failed` ‚Üí red

### 3. Mobile Responsiveness
- ‚úÖ Images MUST use `aspect-square` or responsive sizing
- ‚úÖ Images MUST include `loading="lazy"`
- ‚úÖ Images MUST have error handling: `onError={(e) => { e.target.style.display = 'none' }}`
- ‚úÖ Use Tailwind breakpoints: `sm:`, `md:`, `lg:`, `xl:`

### 4. HTML Content from RSS Feeds
- ‚úÖ MUST sanitize HTML with `sanitizeHtml()` from `frontend/src/utils/sanitizeHtml.js`
- ‚úÖ NEVER render raw HTML without sanitization (XSS risk)
- ‚ùå NEVER use plain `{description}` for RSS content

Example:
```jsx
<div dangerouslySetInnerHTML={{ __html: sanitizeHtml(content) }} />
```

### 5. API Response Format
When modifying backend endpoints that return episodes:
- ‚úÖ MUST include: `status`, `error_message`, `id`, `guid`
- ‚úÖ MUST update status at each processing step
- ‚úÖ MUST set `error_message` on failures

## Code Style (from user rules)

### JavaScript/React
- Use functional components (no classes unless necessary)
- Use camelCase for variables/functions
- Use PascalCase for components
- Prefer const over let
- Use async/await over .then()

### Python
- Use snake_case for functions/variables
- Follow PEP 8
- Use async/await for database operations
- Always include error handling in background tasks

### File Naming
- Directories: kebab-case (e.g., `podcast-intelligence/`)
- React components: PascalCase (e.g., `EpisodeDetail.jsx`)
- Utilities: camelCase (e.g., `sanitizeHtml.js`)
- Python modules: snake_case (e.g., `rss_parser.py`)

## Testing Philosophy (MVP Stage)

üö´ DO NOT suggest comprehensive test suites unless explicitly requested.

The app is in MVP stage with:
- Small user base (friends and family)
- Fast iteration priority
- Manual testing sufficient

ONLY suggest tests when user reaches Phase 2 milestones (see DEVELOPMENT.md):
- 10+ active users
- Adding team members
- Monetization
- Frequent regression bugs

## Common Pitfalls to Avoid

1. ‚ùå Adding new pages without polling ‚Üí Always use `usePolling` hook
2. ‚ùå Displaying raw HTML from RSS feeds ‚Üí Always sanitize
3. ‚ùå Forgetting mobile responsive images ‚Üí Use aspect ratios + breakpoints
4. ‚ùå Missing error messages on failed episodes ‚Üí Include in API responses
5. ‚ùå Not handling image load failures ‚Üí Add onError handlers
6. ‚ùå Creating custom polling logic ‚Üí Use the existing hook

## When Making Changes

Before suggesting code:
1. Check if similar pattern exists in Episodes.jsx or PodcastEpisodes.jsx
2. Verify it follows DEVELOPMENT.md checklist
3. Ensure mobile responsiveness
4. Include proper error handling

## Key Architecture Notes

### Backend Processing Flow
1. Episode created with status="pending"
2. Background task starts: status="downloading"
3. Audio downloaded and compressed if >20MB
4. If >53 min, split into 20-min chunks
5. Status="transcribing" ‚Üí Groq Whisper API
6. Status="summarizing" ‚Üí Groq Llama 3.3
7. Status="completed" with transcript + summary

### Frontend Polling
- My Episodes page: auto-refreshes every 3s
- Podcast Episodes page: auto-refreshes every 3s
- Both use same usePolling hook for consistency

### Current Known Issues (from memory)
- datetime.utcnow() deprecation warning (line 510 in main.py)
- No authentication (using mock user_id=1)
- Background tasks occasionally get stuck in "pending"

## Suggestions Welcome For

‚úÖ UI/UX improvements
‚úÖ Performance optimizations
‚úÖ Error handling enhancements
‚úÖ Mobile experience improvements
‚úÖ Code refactoring to reduce duplication
‚úÖ Accessibility improvements

## Railway Deployment (Production)

### Critical Configuration Requirements

**Backend is deployed on Railway at:** `podcast-intelligence-production.up.railway.app`

#### 1. Dockerfile Requirements
```dockerfile
# MUST include ffmpeg for audio processing
RUN apt-get update && apt-get install -y \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# MUST use shell form for CMD to expand PORT variable
CMD ["sh", "-c", "uvicorn main:app --host 0.0.0.0 --port ${PORT:-8000}"]
```

#### 2. Required Environment Variables on Railway
- `GROQ_API_KEY` - Your Groq API key
- `SECRET_KEY` - Random string for security
- `DATABASE_URL` - `sqlite+aiosqlite:///./podcast_app.db`
- `CORS_ORIGINS` - Frontend URL (or `*` for testing)
- `LLM_PROVIDER` - `groq`
- `TRANSCRIPTION_MODEL` - `whisper-large-v3`
- `SUMMARIZATION_MODEL` - `llama-3.3-70b-versatile`

#### 3. Railway Settings
- **Root Directory:** `/` (NOT `/backend`)
- **Builder:** DOCKERFILE
- **Dockerfile Path:** `Dockerfile` (at project root)
- **Custom Start Command:** Leave empty (let Dockerfile handle it)
- **Health Check Path:** `/health`

#### 4. .gitignore MUST Include
```
# Audio/Episode files (NEVER commit to git!)
output/
storage/
backend/storage/
*.mp3
*.wav
*.16k.wav
```

**Why:** Audio files are 100-200MB each and will break GitHub push (100MB limit)

#### 5. File Storage Architecture
- **Database (SQLite):** Stores episode metadata (title, status, file paths)
- **Filesystem (`backend/storage/`):** Stores actual audio files
- **Git:** ONLY stores code (never audio/media files)

#### 6. If Large Files Accidentally Committed
```bash
# Remove from Git history
git filter-branch --force --index-filter \
  'git rm -r --cached --ignore-unmatch output/' \
  --prune-empty --tag-name-filter cat -- --all

# Force push clean history
git push --force origin main
```

#### 7. Common Deployment Errors & Fixes

**Error:** `[Errno 2] No such file or directory: 'ffmpeg'`  
**Fix:** Add `ffmpeg` to Dockerfile `RUN apt-get install` line

**Error:** `Invalid value for '--port': '$PORT' is not a valid integer`  
**Fix:** Use shell form in CMD: `CMD ["sh", "-c", "uvicorn ... --port ${PORT:-8000}"]`

**Error:** `No start command was found`  
**Fix:** Ensure Root Directory is `/` and remove Custom Start Command in Railway UI

**Error:** `GH001: Large files detected`  
**Fix:** Add audio folders to `.gitignore` and use `git filter-branch` to clean history

#### 8. Deployment Checklist
- [ ] `ffmpeg` in Dockerfile
- [ ] All 7 environment variables set in Railway
- [ ] Root Directory = `/`
- [ ] Audio files in `.gitignore`
- [ ] No Custom Start Command set
- [ ] Health check returns `{"status":"healthy"}`
- [ ] Test episode processing works

## Suggestions to Avoid

‚ùå Major architectural changes (unless critical bug)
‚ùå Adding authentication (planned for Phase 2)
‚ùå Comprehensive test suites (MVP stage)
‚ùå Committing audio/media files to Git (use .gitignore!)
‚ùå Database migrations to PostgreSQL (SQLite fine for MVP)

## Response Style

When helping with code:
- Be concise and action-oriented
- Show code examples, not just explanations
- Reference DEVELOPMENT.md checklist items when relevant
- Point out if a pattern already exists to copy
- Ask clarifying questions if requirements unclear
- Suggest simple solutions over complex ones (MVP mindset)

## Memory Context

The user has built this app to share with non-technical friends. They value:
- Fast iteration
- Working features over perfect code
- Mobile-friendly design
- Clear error messages for users
- Learning good practices without over-engineering

---

**Last Updated:** November 30, 2024
**Project Stage:** MVP - Deployed to Railway, ready to share with friends
**Backend URL:** https://podcast-intelligence-production.up.railway.app



